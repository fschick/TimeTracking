<!-- Filter -->
<ts-filter filterId="filterReports"
           [filters]="filters"
           (filterChanged)="filterChanged.next($event)">
</ts-filter>

<hr>

<!-- Chart -->
<h4 class="d-inline-block" i18n="@@Page.Report.Orders.Title">
  [i18n] Planned/actual by order
</h4>
<div id="chart" *ngIf="chartSeries">
  <apx-chart
    [series]="chartSeries"
    [chart]="chartOptions.chart"
    [dataLabels]="chartOptions.dataLabels"
    [plotOptions]="chartOptions.plotOptions"
    [xaxis]="chartOptions.xAxis"
    [yaxis]="chartOptions.yAxis"
    [colors]="chartOptions.colors"
    [stroke]="chartOptions.stroke"
    [tooltip]="chartOptions.tooltip"
    [states]="chartOptions.states"
    [legend]="chartOptions.legend"
  ></apx-chart>
</div>

<ts-simple-table
  [columns]="tableColumns"
  [rows]="tableRows"
  [configuration]="tableConfiguration"
  (rowsChanged)="tableRowsChanged($event.rows)">
</ts-simple-table>

<div *ngIf="plannedArePartial" class="row">
  <div class="col p-0">
    <div class="alert alert-warning m-2" role="alert">
      <ts-icon icon="bi bi-exclamation-triangle" class="me-1"></ts-icon>
      <ng-container i18n="@@Page.Report.Common.PartialPlannedValues">
        [i18n] The order period is greater than selected period. The values are displayed proportionally.
      </ng-container>
    </div>
  </div>
</div>

<ng-template #orderPeriodHeadTemplate let-table="table" let-column="column">
  <span class="d-none d-lg-inline">{{column.title}}</span>
  <span class="d-none d-lg-inline" [class]="table.getCssSortOrder(column)">{{table.getGlyphSortOrder(column)}}</span>
</ng-template>

<ng-template #orderPeriodDataTemplate let-row="row">
  <span class="d-none d-lg-inline">{{formatService.formatDate(row.plannedStart)}} - {{formatService.formatDate(row.plannedEnd)}}</span>
  <ts-icon *ngIf="row.plannedIsPartial" icon="bi bi-exclamation-triangle" class="action-icon text-warning ms-1"></ts-icon>
</ng-template>

<ng-template #orderPeriodFooterTemplate let-column="column">
  <span class="d-none d-lg-inline">{{getMinPlanned()}} - {{getMaxPlanned()}}</span>
</ng-template>

<ng-template #infoCellTemplate let-row="row">
  <a class="text-secondary ms-2"
     [ngbPopover]="infoDetailPopover"
     [autoClose]="'outside'"
     popoverClass="popup-full-width">
    <ts-icon icon="bi bi-box-arrow-up-right" class="action-icon"></ts-icon>
  </a>

  <ng-template #infoDetailPopover>
    <table class="table table-borderless table-sm">
      <thead>
      <tr>
        <th></th>
        <th class="text-nowrap text-end" i18n="@@Page.Report.Common.Days">[i18n] Days</th>
        <th class="text-nowrap text-end" i18n="@@Page.Report.Common.Hours">[i18n] Hours</th>
        <th class="text-nowrap text-end" i18n="@@Page.Report.Common.Budget">[i18n] Budget</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <th scope="row" class="pe-2" i18n="@@Page.Report.Common.Worked">[i18n] Worked</th>
        <td class="text-nowrap text-end">{{formatService.formatDays(row.daysWorked)}} {{localizedDays}}</td>
        <td class="text-nowrap text-end">{{row.timeWorked | tsDuration}} {{localizedHours}}</td>
        <td class="text-nowrap text-end">{{formatService.formatBudget(row.budgetWorked)}} {{row.currency}}</td>
      </tr>
      <tr>
        <th scope="row" class="pe-2" i18n="@@Page.Report.Common.Planned">[i18n] Planned</th>
        <td class="text-nowrap text-end">{{formatService.formatDays(row.daysPlanned)}} {{localizedDays}}</td>
        <td class="text-nowrap text-end">{{row.timePlanned | tsDuration}} {{localizedHours}}</td>
        <td class="text-nowrap text-end">{{formatService.formatBudget(row.budgetPlanned)}} {{row.currency}}</td>
      </tr>
      <tr>
        <th scope="row" class="pe-2" i18n="@@Page.Report.Common.Remain">[i18n] Remain</th>
        <td class="text-nowrap text-end">{{formatService.formatDays(row.daysDifference)}} {{localizedDays}}</td>
        <td class="text-nowrap text-end">{{row.timeDifference | tsDuration}} {{localizedHours}}</td>
        <td class="text-nowrap text-end">{{formatService.formatBudget(row.budgetDifference)}} {{row.currency}}</td>
      </tr>
      </tbody>
    </table>
  </ng-template>
</ng-template>

<ng-template #infoFooterTemplate>
  <ng-container *ngTemplateOutlet="infoCellTemplate; context: {row: tableFooter}"></ng-container>
</ng-template>
