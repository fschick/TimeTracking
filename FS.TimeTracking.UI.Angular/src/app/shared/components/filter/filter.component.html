<!-- Header -->
<div class="mb-4">
  <h4 class="col-auto" i18n="@@Component.Filter.Title">[i18n] Filter</h4>
  <div>
    <button *ngIf="isFiltered$ | async"
            (click)="resetFilterForm()"
            type="button"
            class="btn btn-primary"
            i18n="@@Component.Filter.Reset">
      [i18n] Reset filter
    </button>
  </div>
</div>

<form *ngIf="filterForm !== undefined" id="filterForm" [formGroup]="filterForm">

  <ng-container *ngIf="filterTemplates">
    <!-- Standard filter -->
    <div class="row g-3">
      <ng-container *ngFor="let filter of primaryFilters">
        <ng-container *ngTemplateOutlet="filterTemplates[filter.name]"></ng-container>
      </ng-container>
    </div>

    <!-- Extended filter -->
    <div id="extendedFilter" class="collapse">
      <div class="row g-3 my-0">
        <ng-container *ngFor="let filter of secondaryFilters">
          <ng-container *ngTemplateOutlet="filterTemplates[filter.name]"></ng-container>
        </ng-container>
      </div>
    </div>

    <button *ngIf="secondaryFilters && secondaryFilters.length"
            id="extended-filter-toggler"
            type="button"
            class="btn btn-outline-secondary collapsed ms-2"
            data-bs-toggle="collapse"
            data-bs-target="#extendedFilter"
            aria-expanded="false"
            aria-controls="extendedFilter">
      <span class="text-expand" i18n="@@Common.Expand">[i18n] Expand</span>
      <span class="text-collapse" i18n="@@Common.Collapse">[i18n] Collapse</span>
    </button>
  </ng-container>


  <ng-template #timeSheetStartDate>
    <div class="col-12">
      <label class="form-label" i18n="@@Component.Filter.LimitPeriod">[i18n] Limit period</label>
      <label class="form-label visually-hidden" for="timeSheetStartDate" i18n="@@Component.Filter.From">[i18n] From</label>
      <ts-date-month-picker
        id="timeSheetStartDate"
        [ngClass]="{ 'filtered': isFieldFiltered('timeSheetStartDate') }"
        placeholderMonth="[i18n] from"
        i18n-placeholderMonth="@@Component.Filter.From"
        placeholderDate="[i18n] Start"
        i18n-placeholderDate="@@Component.Filter.Start"
        formControlName="timeSheetStartDate"
        [clearBtn]="isResettable('timeSheetStartDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #timeSheetEndDate>
    <div class="col-12">
      <label class="form-label visually-hidden" for="timeSheetEndDate" i18n="@@Component.Filter.To">[i18n] To</label>
      <ts-date-month-picker
        id="timeSheetEndDate"
        [ngClass]="{ 'filtered': isFieldFiltered('timeSheetEndDate') }"
        placeholderMonth="[i18n] to"
        i18n-placeholderMonth="@@Component.Filter.To"
        placeholderDate="[i18n] End"
        i18n-placeholderDate="@@Component.Filter.End"
        formControlName="timeSheetEndDate"
        relativeAnchor="end"
        [clearBtn]="isResettable('timeSheetEndDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #orderStartDate>
    <div class="col-12">
      <label class="form-label" i18n="@@Component.Filter.LimitPeriod">[i18n] Limit period</label>
      <label class="form-label visually-hidden" for="orderStartDate" i18n="@@Component.Filter.From">[i18n] From</label>
      <ts-date-month-picker
        id="orderStartDate"
        [ngClass]="{ 'filtered': isFieldFiltered('orderStartDate') }"
        placeholderMonth="[i18n] from"
        i18n-placeholderMonth="@@Component.Filter.From"
        placeholderDate="[i18n] Start"
        i18n-placeholderDate="@@Component.Filter.Start"
        formControlName="orderStartDate"
        [clearBtn]="isResettable('orderStartDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #orderDueDate>
    <div class="col-12">
      <label class="form-label visually-hidden" for="orderDueDate" i18n="@@Component.Filter.To">[i18n] To</label>
      <ts-date-month-picker
        id="orderDueDate"
        [ngClass]="{ 'filtered': isFieldFiltered('orderDueDate') }"
        placeholderMonth="[i18n] to"
        i18n-placeholderMonth="@@Component.Filter.To"
        placeholderDate="[i18n] End"
        i18n-placeholderDate="@@Component.Filter.End"
        formControlName="orderDueDate"
        relativeAnchor="end"
        [clearBtn]="isResettable('orderDueDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #holidayStartDate>
    <div class="col-12">
      <label class="form-label" i18n="@@Component.Filter.LimitPeriod">[i18n] Limit period</label>
      <label class="form-label visually-hidden" for="holidayStartDate" i18n="@@Component.Filter.From">[i18n] From</label>
      <ts-date-month-picker
        id="holidayStartDate"
        [ngClass]="{ 'filtered': isFieldFiltered('holidayStartDate') }"
        placeholderMonth="[i18n] from"
        i18n-placeholderMonth="@@Component.Filter.From"
        placeholderDate="[i18n] Start"
        i18n-placeholderDate="@@Component.Filter.Start"
        formControlName="holidayStartDate"
        [clearBtn]="isResettable('holidayStartDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #holidayEndDate>
    <div class="col-12">
      <label class="form-label visually-hidden" for="holidayEndDate" i18n="@@Component.Filter.To">[i18n] To</label>
      <ts-date-month-picker
        id="holidayEndDate"
        [ngClass]="{ 'filtered': isFieldFiltered('holidayEndDate') }"
        placeholderMonth="[i18n] to"
        i18n-placeholderMonth="@@Component.Filter.To"
        placeholderDate="[i18n] End"
        i18n-placeholderDate="@@Component.Filter.End"
        formControlName="holidayEndDate"
        relativeAnchor="end"
        [clearBtn]="isResettable('holidayEndDate')">
      </ts-date-month-picker>
    </div>
  </ng-template>

  <ng-template #customerId>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="customerTitle" class="form-label" i18n="@@Component.Filter.Customer">[i18n] Customer</label>
      <ng-select [items]="customers$ | async"
                 [selectOnTab]="true"
                 [multiple]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('customerId') }"
                 placeholder="[i18n] Customer"
                 i18n-placeholder="@@Component.Filter.Customer"
                 bindValue="id"
                 bindLabel="value"
                 labelForId="customerTitle"
                 formControlName="customerId">
        <ng-template ng-option-tmp let-item="item">
          <span [ngClass]="{'text-decoration-line-through': item.hidden, 'text-secondary': item.hidden}">{{item.value}}</span>
        </ng-template>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #projectId>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="projectTitle" class="form-label" i18n="@@Component.Filter.Project">[i18n] Project</label>
      <ng-select [items]="projects$ | async"
                 [selectOnTab]="true"
                 [multiple]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('projectId') }"
                 bindValue="id"
                 bindLabel="value"
                 placeholder="[i18n] Project"
                 i18n-placeholder="@@Component.Filter.Project"
                 labelForId="projectTitle"
                 formControlName="projectId">
        <ng-template ng-option-tmp let-item="item">
          <span [ngClass]="{'text-decoration-line-through': item.hidden, 'text-secondary': item.hidden}">{{item.value}}</span>
        </ng-template>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #activityId>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="activityTitle" class="form-label" i18n="@@Component.Filter.Activity">[i18n] Activity</label>
      <ng-select [items]="activities$ | async"
                 [selectOnTab]="true"
                 [multiple]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('activityId') }"
                 bindValue="id"
                 bindLabel="value"
                 placeholder="[i18n] Activity"
                 i18n-placeholder="@@Component.Filter.Activity"
                 labelForId="activityTitle"
                 formControlName="activityId">
        <ng-template ng-option-tmp let-item="item">
          <span [ngClass]="{'text-decoration-line-through': item.hidden, 'text-secondary': item.hidden}">{{item.value}}</span>
        </ng-template>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #orderId>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="orderTitle" class="form-label" i18n="@@Component.Filter.Order">[i18n] Order</label>
      <ng-select [items]="orders$ | async"
                 [selectOnTab]="true"
                 [multiple]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('orderId') }"
                 placeholder="[i18n] Order"
                 i18n-placeholder="@@Component.Filter.Order"
                 bindValue="id"
                 bindLabel="value"
                 labelForId="orderTitle"
                 formControlName="orderId">
        <ng-template ng-option-tmp let-item="item">
          <span [ngClass]="{'text-decoration-line-through': item.hidden, 'text-secondary': item.hidden}">{{item.value}}</span>
        </ng-template>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #timeSheetIssue>
    <div class="col-12">
      <label for="timeSheetIssue" class="form-label" i18n="@@Component.Filter.Issue">[i18n] Issue</label>
      <input id="timeSheetIssue"
             [ngClass]="{ 'filtered': isFieldFiltered('timeSheetIssue') }"
             type="text"
             class="form-control"
             placeholder="[i18n] Issue"
             i18n-placeholder="@@Component.Filter.Issue"
             formControlName="timeSheetIssue"
             (keydown.enter)="setFormValue($event, 'timeSheetIssue')">
    </div>
  </ng-template>

  <ng-template #customerNumber>
    <div class="col-12">
      <label for="customerNumber" class="form-label" i18n="@@Component.Filter.CustomerNumber">[i18n] Number</label>
      <input id="customerNumber"
             [ngClass]="{ 'filtered': isFieldFiltered('customerNumber') }"
             type="text"
             class="form-control"
             placeholder="[i18n] Number"
             i18n-placeholder="@@Component.Filter.CustomerNumber"
             formControlName="customerNumber"
             (keydown.enter)="setFormValue($event, 'customerNumber')">
    </div>
  </ng-template>

  <ng-template #customerCompanyName>
    <div class="col-12">
      <label for="customerCompanyName" class="form-label" i18n="@@Component.Filter.CustomerCompanyName">[i18n] Company</label>
      <input id="customerCompanyName"
             [ngClass]="{ 'filtered': isFieldFiltered('customerCompanyName') }"
             type="text"
             class="form-control"
             placeholder="[i18n] Company"
             i18n-placeholder="@@Component.Filter.CustomerCompanyName"
             formControlName="customerCompanyName"
             (keydown.enter)="setFormValue($event, 'customerCompanyName')">
    </div>
  </ng-template>

  <ng-template #timeSheetComment>
    <div class="col-12">
      <label for="timeSheetComment" class="form-label" i18n="@@Component.Filter.Comment">[i18n] Comment</label>
      <input id="timeSheetComment"
             [ngClass]="{ 'filtered': isFieldFiltered('timeSheetComment') }"
             type="text"
             class="form-control"
             placeholder="[i18n] Comment"
             i18n-placeholder="@@Component.Filter.Comment"
             formControlName="timeSheetComment"
             (keydown.enter)="setFormValue($event, 'timeSheetComment')">
    </div>
  </ng-template>

  <ng-template #holidayTitle>
    <div class="col-12">
      <label for="holidayTitle" class="form-label" i18n="@@Component.Filter.HolidayTitle">[i18n] Title</label>
      <input id="holidayTitle"
             [ngClass]="{ 'filtered': isFieldFiltered('holidayTitle') }"
             type="text"
             class="form-control"
             placeholder="[i18n] Title"
             i18n-placeholder="@@Component.Filter.HolidayTitle"
             formControlName="holidayTitle"
             (keydown.enter)="setFormValue($event, 'holidayTitle')">
    </div>
  </ng-template>

  <ng-template #activityHidden>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="activityHidden" class="form-label" i18n="@@Component.Filter.Hidden">[i18n] Hidden</label>
      <ng-select [selectOnTab]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('activityHidden') }"
                 placeholder="[i18n] Hidden"
                 i18n-placeholder="@@Component.Filter.Hidden"
                 labelForId="activityHidden"
                 formControlName="activityHidden">
        <ng-option [value]="true" i18n="@@Common.Yes">[i18n] Yes</ng-option>
        <ng-option [value]="false" i18n="@@Common.No">[i18n] No</ng-option>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #customerHidden>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="customerHidden" class="form-label" i18n="@@Component.Filter.Hidden">[i18n] Hidden</label>
      <ng-select [selectOnTab]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('customerHidden') }"
                 placeholder="[i18n] Hidden"
                 i18n-placeholder="@@Component.Filter.Hidden"
                 labelForId="customerHidden"
                 formControlName="customerHidden">
        <ng-option [value]="true" i18n="@@Common.Yes">[i18n] Yes</ng-option>
        <ng-option [value]="false" i18n="@@Common.No">[i18n] No</ng-option>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #projectHidden>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="projectHidden" class="form-label" i18n="@@Component.Filter.Hidden">[i18n] Hidden</label>
      <ng-select [selectOnTab]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('projectHidden') }"
                 placeholder="[i18n] Hidden"
                 i18n-placeholder="@@Component.Filter.Hidden"
                 labelForId="projectHidden"
                 formControlName="projectHidden">
        <ng-option [value]="true" i18n="@@Common.Yes">[i18n] Yes</ng-option>
        <ng-option [value]="false" i18n="@@Common.No">[i18n] No</ng-option>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #holidayType>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="holidayType" class="form-label" i18n="@@Component.Filter.HolidayType">[i18n] Type</label>
      <ng-select [ngClass]="{ 'filtered': isFieldFiltered('holidayType') }"
                 placeholder="[i18n] Type"
                 i18n-placeholder="@@Component.Filter.HolidayType"
                 labelForId="holidayType"
                 formControlName="holidayType">
        <ng-option value="Holiday" i18n="@@Enum.HolidayType.Holiday">[i18n] Holidays / Vacation</ng-option>
        <ng-option value="PublicHoliday" i18n="@@Enum.HolidayType.PublicHoliday">[i18n] Public holiday</ng-option>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #timeSheetBillable>
    <div class="col-12">
      <!--suppress XmlInvalidId -->
      <label for="timeSheetBillable" class="form-label" i18n="@@Component.Filter.Billable">[i18n] Billable</label>
      <ng-select [selectOnTab]="true"
                 [ngClass]="{ 'filtered': isFieldFiltered('timeSheetBillable') }"
                 placeholder="[i18n] Billable"
                 i18n-placeholder="@@Component.Filter.Billable"
                 labelForId="timeSheetBillable"
                 formControlName="timeSheetBillable">
        <ng-option [value]="true" i18n="@@Common.Yes">[i18n] Yes</ng-option>
        <ng-option [value]="false" i18n="@@Common.No">[i18n] No</ng-option>
      </ng-select>
    </div>
  </ng-template>

  <ng-template #showDetails>
    <div class="col-12">
      <div class="form-check form-switch d-inline-block me-3">
        <input class="form-check-input" type="checkbox" role="switch" id="showDetails" formControlName="showDetails">
        <label class="form-check-label" for="showDetails" i18n="@@Page.Timesheet.ShowDetails">
          [i18n] Show details
        </label>
      </div>
    </div>
  </ng-template>

  <ng-template #filterNotImplemented>
    <div class="col-12">
      <label for="filterNotImplemented" class="visually-hidden">FILTER NOT IMPLEMENTED</label>
      <input type="text" readonly class="form-control-plaintext" id="filterNotImplemented" value="FILTER NOT IMPLEMENTED">
    </div>
  </ng-template>
</form>
